# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ BreedHub 3.0

## –û–≥–ª—è–¥

BreedHub 3.0 - —Ü–µ Local-First PWA –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑ AI-–ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é —á–µ—Ä–µ–∑ Gemma 270M, –Ω–∞—Ç—Ö–Ω–µ–Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ –¢–∏–º—É—Ä–∞ –®–µ–º—Å–µ–¥—ñ–Ω–æ–≤–∞. –í—Å—ñ –¥–∞–Ω—ñ —Ç–∞ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Å–µ—Ä–≤–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó. –°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **RxDB** - reactive –æ—Ñ–ª–∞–π–Ω-first –±–∞–∑—É –¥–∞–Ω–∏—Ö –∑ –≤–±—É–¥–æ–≤–∞–Ω–æ—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é –∑ Supabase/PostgreSQL, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º conflict resolution —Ç–∞ –ø–æ—Ç—É–∂–Ω–∏–º query engine. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ–≤–Ω—É –æ—Ñ–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∑ —Ä–µ–∞–∫—Ç–∏–≤–Ω–∏–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏ —á–µ—Ä–µ–∑ RxJS —Ç–∞ @preact/signals.

## –ö–ª—é—á–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

### 1. Local-First Computing (–∑–∞ –®–µ–º—Å–µ–¥—ñ–Ω–æ–≤–∏–º)
- **RxDB + IndexedDB** —è–∫ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞ —Ä–µ–∞–∫—Ç–∏–≤–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π conflict resolution** —á–µ—Ä–µ–∑ configurable strategies
- **–ú–∏—Ç—Ç—î–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å** - –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–∫–∞–ª—å–Ω—ñ (<1ms)
- **–ü–æ–≤–Ω–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω—ñ—Å—Ç—å** - –ø—Ä–∞—Ü—é—î –±–µ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –Ω–µ–æ–±–º–µ–∂–µ–Ω–æ
- **Eventual consistency** - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–ª–∏ –∑'—è–≤–∏—Ç—å—Å—è –∑–≤'—è–∑–æ–∫

### 2. Offline-First Data Layer –∑ RxDB
- **RxDB Collections** - —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó –∑ schema validation
- **Reactive Queries** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI —á–µ—Ä–µ–∑ RxJS
- **SignalStore** —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –∑ RxDB –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- **–í–±—É–¥–æ–≤–∞–Ω–∞ Supabase —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π push/pull
- **Web Workers** –¥–ª—è —Ñ–æ–Ω–æ–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è UI

### 3. Event-Driven –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
- **Event Sourcing** –¥–ª—è breeding —Ç–∞ health –æ–ø–µ—Ä–∞—Ü—ñ–π
- **–ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω** –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è
- **CQRS** –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏—Ö read models
- **–ß–∞—Å–æ–≤—ñ –∑–∞–ø–∏—Ç–∏** –Ω–∞ –±—É–¥—å-—è–∫—É –¥–∞—Ç—É

### 4. AI-Powered Features (Gemma 270M)
- **WebGPU acceleration** - 15-40 tokens/s –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –¥–µ–≤–∞–π—Å–∞—Ö
- **540MB –º–æ–¥–µ–ª—å** - —à–≤–∏–¥–∫–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –∫–µ—à—É—î—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ
- **Natural Language Interface** –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
- **Intelligent Breeding Recommendations** –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≥–µ–Ω–µ—Ç–∏–∫–∏
- **Automated Pedigree Analysis** —Ç–∞ duplicate detection
- **–ü—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω** –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

## –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π —Å—Ç–µ–∫

### Frontend (Local-First PWA)
- **Vite + React 18.3+** –∑ TypeScript 5.0+
- **RxDB** - —Ä–µ–∞–∫—Ç–∏–≤–Ω–∞ –æ—Ñ–ª–∞–π–Ω-first –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- **RxJS** –¥–ª—è reactive programming
- **@preact/signals-react** –¥–ª—è UI —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- **Dexie.js** —è–∫ storage backend –¥–ª—è RxDB
- **@mediapipe/tasks-genai** –¥–ª—è Gemma 270M
- **Vite PWA Plugin** –¥–ª—è service workers
- **Web Workers** –¥–ª—è —Ñ–æ–Ω–æ–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

### Backend —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Supabase** –Ω–∞ dev.dogarray.com —á–µ—Ä–µ–∑ Coolify (–æ–∫—Ä–µ–º–æ –≤—ñ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é)
- **Windmill** –æ–∫—Ä–µ–º–∏–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è serverless —Ñ—É–Ω–∫—Ü—ñ–π
- **PostgreSQL** –∑ dynamic schemas (–ø–æ—Ä—Ç 5432)
- **pgvector** –¥–ª—è semantic search —Ç–∞ embeddings (–ø–ª–∞–Ω—É—î—Ç—å—Å—è)
- **HTTP extension** –¥–ª—è –≤–∏–∫–ª–∏–∫—É Windmill –∑ Supabase
- **Gemma 270M** –≤ Windmill –¥–ª—è batch processing (–ø–ª–∞–Ω—É—î—Ç—å—Å—è)

### AI & Development
- **Gemma 270M** (540MB) - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
- **WebGPU** –ø–µ—Ä—à–æ—á–µ—Ä–≥–æ–≤–æ, fallback –Ω–∞ WASM
- **IndexedDB** –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ
- **GitHub Copilot** –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏
- **CLAUDE.md** –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è AI –∞—Å–∏—Å—Ç–µ–Ω—Ç—ñ–≤

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ –¥—ñ–∞–≥—Ä–∞–º–∞

```mermaid
graph TB
    subgraph "Local-First PWA Client"
        UI[React UI]
        SS[SignalStore]
        
        subgraph "RxDB Layer"
            RXDB[RxDB Database]
            COLL[Collections]
            QUERY[Query Engine]
            IDB[(IndexedDB/Dexie)]
        end
        
        subgraph "AI Engine"
            GEMMA[Gemma 270M]
            WGPU[WebGPU]
        end
        
        SW[Service Worker]
        WW[Web Workers]
    end

    subgraph "Sync Layer"
        REPL[RxDB Replication]
        SYNC[Supabase Sync Plugin]
    end

    subgraph "Backend (Sync Only)"
        SB[Supabase]
        PG[(PostgreSQL)]
        WM[Windmill]
    end

    UI --> SS
    SS --> RXDB
    RXDB --> COLL
    COLL --> IDB
    
    UI --> GEMMA
    GEMMA --> WGPU
    
    WW --> REPL
    REPL --> SYNC
    SYNC --> SB
    SB --> PG
    
    SW --> RXDB
    COLL --> QUERY
```

## –†–µ–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—ñ–≤

### BreedHub Local-First PWA Structure
```
breedhub-pwa/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json          # PWA manifest
‚îÇ   ‚îú‚îÄ‚îÄ sw.js                  # Service Worker
‚îÇ   ‚îú‚îÄ‚îÄ workers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sync.worker.js    # Background sync
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îÇ       ‚îî‚îÄ‚îÄ gemma-270m.bin     # AI –º–æ–¥–µ–ª—å (540MB)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ local-first/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LocalFirstStore.ts # CRDT store wrapper
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SignalStore.ts     # Reactive signals
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SyncEngine.ts      # Sync orchestration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ConflictResolver.ts # Merge strategies
‚îÇ   ‚îú‚îÄ‚îÄ ai/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GemmaService.ts    # WebGPU AI engine
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workers/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ai.worker.ts   # AI in Web Worker
‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ breeds.store.ts    # LocalFirstStore<Breed>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dogs.store.ts      # LocalFirstStore<Dog>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sync.store.ts      # Sync status signals
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                # Base components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ breeds/            # Domain components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sync/              # Sync UI indicators
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useLocalFirst.ts   # Main data hook
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSync.ts         # Sync status hook
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useAI.ts           # AI features hook
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îú‚îÄ‚îÄ vite.config.ts
‚îî‚îÄ‚îÄ package.json

### Windmill Repository (`/projects/windmill/`)
‚îú‚îÄ‚îÄ f/
‚îÇ   ‚îú‚îÄ‚îÄ common/                # –Ü—Å–Ω—É—é—á—ñ —É—Ç–∏–ª—ñ—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config_merge.deno.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ json_merge.deno.ts
‚îÇ   ‚îú‚îÄ‚îÄ breeding/              # –Ü—Å–Ω—É—é—á—ñ breeding scripts
‚îÇ   ‚îú‚îÄ‚îÄ measurements/          # –Ü—Å–Ω—É—é—á—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ supabase/             # Supabase —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
‚îÇ   ‚îî‚îÄ‚îÄ ai/                   # –ü–õ–ê–ù–£–Ñ–¢–¨–°–Ø: Gemma scripts
‚îÇ       ‚îú‚îÄ‚îÄ pedigree_parser.py
‚îÇ       ‚îú‚îÄ‚îÄ duplicate_detector.py
‚îÇ       ‚îî‚îÄ‚îÄ breeding_advisor.py
‚îî‚îÄ‚îÄ u/
    ‚îî‚îÄ‚îÄ annamaliyenko/        # User resources
        ‚îî‚îÄ‚îÄ pleasing_supabase.resource.yaml

### –ó–æ–≤–Ω—ñ—à–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ (–Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—è—Ö)
- Supabase: dev.dogarray.com:8020 (API), :5432 (PostgreSQL)
- Windmill: dev.dogarray.com:8000
```

## –ü–æ–µ—Ç–∞–ø–Ω–µ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è

### –§–∞–∑–∞ 1: –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ—Å–Ω—É—é—á–µ ‚úÖ
- ~~MultiStore/SignalStore –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞~~ ‚Üí –ú—ñ–≥—Ä—É—î–º–æ –Ω–∞ NgRx Signal Store
- Supabase + Windmill —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è  
- Dynamic schemas –≤ –ë–î
- Hierarchical configs

### –§–∞–∑–∞ 1.5: NgRx Signal Store Migration (–ù–û–í–ê) üÜï
- **@ngrx/signals** –∑–∞–º—ñ—Å—Ç—å –≤–ª–∞—Å–Ω–æ–≥–æ SignalStore
- **Config-driven stores** –∑ Supabase configs
- **withEntities, withComputed, withMethods, withHooks** patterns
- **Dynamic store generation** –Ω–∞ –æ—Å–Ω–æ–≤—ñ app_config

### –§–∞–∑–∞ 2: NgRx Signal Store Architecture

#### Config-Driven Store Generation
```typescript
// packages/signal-store/src/stores/dynamic-universal.store.ts
import { signalStore, withState, withComputed, withMethods, withHooks } from '@ngrx/signals';
import { withEntities } from '@ngrx/signals/entities';

export const DynamicUniversalStore = await (async () => {
  // Load configs from Supabase
  const configs = await configLoader.loadConfigs();
  
  return signalStore(
    { providedIn: 'root' },
    
    // Generate features for each collection dynamically
    ...configs.flatMap(config => [
      withEntities({
        entity: type(config.entity_type),
        collection: config.collection_name,
        selectId: (e) => e.id
      }),
      withComputed(generateComputedFromConfig(config)),
      withMethods(generateMethodsFromConfig(config)),
      withHooks(generateHooksFromConfig(config))
    ]),
    
    // Global state and methods
    withState({ syncStatus: 'idle', collections: [] }),
    withMethods((store) => ({
      syncAll: () => syncAllCollections(store),
      reloadConfigs: () => dynamicReload(store)
    }))
  );
})();
```

#### NgRx Signal Store Features:

1. **withEntities** - Entity Management
```typescript
withEntities<Breed>({
  entity: type<Breed>(),
  collection: 'breeds',
  selectId: (breed) => breed.id
})
// Provides: breedsEntities, breedsEntityMap, breedsIds signals
```

2. **withComputed** - Reactive Derived State
```typescript
withComputed(({ breedsEntities }) => ({
  popularBreeds: computed(() => 
    breedsEntities().filter(b => b.popularityRank <= 10)
  ),
  breedsBySize: computed(() => 
    groupBy(breedsEntities(), 'size')
  )
}))
```

3. **withMethods** - Business Logic
```typescript
withMethods((store, supabase = inject(SupabaseClient)) => ({
  async addBreed(breed: Partial<Breed>) {
    const { data } = await supabase.from('breeds').insert(breed);
    patchState(store, addEntity(data));
  },
  searchBreeds(query: string) {
    patchState(store, updateFilter({ search: query }));
  }
}))
```

4. **withHooks** - Lifecycle Management
```typescript
withHooks({
  onInit(store) {
    store.syncAll(); // Initial load
    setupRealtimeSubscription(store); // Real-time updates
  },
  onDestroy() {
    cleanupSubscriptions();
  }
})
```

### –§–∞–∑–∞ 3: RxDB Data Layer (–¢–∏–∂–Ω—ñ 3-4)

#### RxDB Database Setup
```typescript
// src/database/index.ts
import { createRxDatabase, RxDatabase } from 'rxdb';
import { getRxStorageDexie } from 'rxdb/plugins/storage-dexie';
import { RxDBDevModePlugin } from 'rxdb/plugins/dev-mode';
import { signal } from '@preact/signals-react';

// Enable dev mode for debugging
if (import.meta.env.DEV) {
  addRxPlugin(RxDBDevModePlugin);
}

export async function createBreedHubDB(): Promise<RxDatabase> {
  const db = await createRxDatabase({
    name: 'breedhub',
    storage: getRxStorageDexie(),
    multiInstance: true,
    eventReduce: true,
    cleanupPolicy: {
      minimumDeletedTime: 1000 * 60 * 60 * 24 * 7, // 7 days
      minimumCollectionAge: 1000 * 60 * 60 * 24,
      runEach: 1000 * 60 * 60 * 4
    }
  });

  // Add collections with schemas
  await db.addCollections({
    breeds: {
      schema: breedSchema,
      methods: breedMethods,
      statics: breedStatics
    },
    dogs: {
      schema: dogSchema,
      methods: dogMethods
    },
    kennels: {
      schema: kennelSchema
    },
    litters: {
      schema: litterSchema
    }
  });

  return db;
}

// Integration with SignalStore
export class RxDBSignalStore<T> {
  private collection: RxCollection<T>;
  private items = signal<T[]>([]);
  private loading = signal(false);
  
  constructor(collection: RxCollection<T>) {
    this.collection = collection;
    
    // RxDB ‚Üí Signals reactivity
    this.collection.$.subscribe(docs => {
      this.items.value = docs;
    });
  }
  
  // Reactive queries
  find(query: MangoQuery<T>) {
    return this.collection.find(query).$;
  }
  
  // CRUD operations - instant and offline
  async create(data: T) {
    return this.collection.insert(data);
  }
  
  async update(id: string, updates: Partial<T>) {
    const doc = await this.collection.findOne(id).exec();
    if (doc) {
      await doc.patch(updates);
    }
  }
  
  async delete(id: string) {
    const doc = await this.collection.findOne(id).exec();
    if (doc) {
      await doc.remove();
    }
  }
}
```

#### Supabase Replication Setup
```typescript
// src/database/replication.ts
import { replicateRxCollection } from 'rxdb/plugins/replication';
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  'http://dev.dogarray.com:8020',
  process.env.VITE_SUPABASE_ANON_KEY
);

export async function setupSupabaseReplication(db: RxDatabase) {
  // Replication –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó
  const collections = ['breeds', 'dogs', 'kennels', 'litters'];
  
  for (const collectionName of collections) {
    const collection = db[collectionName];
    
    const replicationState = replicateRxCollection({
      collection,
      replicationIdentifier: `${collectionName}-supabase`,
      
      // Pull from Supabase
      pull: {
        async handler(checkpoint) {
          const query = supabase
            .from(collectionName)
            .select('*')
            .order('updated_at', { ascending: true });
            
          if (checkpoint) {
            query.gt('updated_at', checkpoint.updated_at);
          }
          
          const { data, error } = await query.limit(100);
          
          if (error) throw error;
          
          return {
            documents: data || [],
            checkpoint: data?.length ? 
              { updated_at: data[data.length - 1].updated_at } : 
              checkpoint
          };
        },
        batchSize: 100,
        modifier: (doc) => doc // Transform if needed
      },
      
      // Push to Supabase
      push: {
        async handler(docs) {
          const { error } = await supabase
            .from(collectionName)
            .upsert(docs);
            
          if (error) throw error;
          return [];
        },
        batchSize: 50,
        modifier: (doc) => doc
      }
    });
    
    // Error handling
    replicationState.error$.subscribe(err => {
      console.error(`Replication error for ${collectionName}:`, err);
    });
  }
}
```

### –§–∞–∑–∞ 3: Event Sourcing (–¢–∏–∂–Ω—ñ 3-4)

#### Event Store –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
```typescript
// packages/event-store/events/BreedingEvents.ts
interface BreedingEvent extends EntityEvent {
  type: 'DogBred' | 'LitterBorn' | 'PuppyRegistered';
  entityType: 'dog' | 'litter';
  aggregateId: string;
  timestamp: Date;
  userId: string;
  data: any;
  metadata?: {
    workspaceId: string;
    spaceId: string;
  };
}

// packages/event-store/EventedSignalStore.ts
export class EventedSignalStore extends SignalStore {
  private eventStore: EventStore;
  
  async dispatch(event: BreedingEvent) {
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–¥—ñ—é
    await this.eventStore.append(event);
    
    // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª–∏
    this.updateSignal(event.entityId, event.data);
    
    // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ —á–µ—Ä–µ–∑ Windmill —è–∫—â–æ –æ–Ω–ª–∞–π–Ω
    if (this.isOnline) {
      await this.callWindmillScript('process_event', event);
    }
  }
  
  // –í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –Ω–∞ –¥–∞—Ç—É
  async getStateAt(entityId: string, date: Date) {
    const events = await this.eventStore.getEventsUntil(entityId, date);
    return this.replayEvents(events);
  }
}
```

#### SQL –º—ñ–≥—Ä–∞—Ü—ñ—è –¥–ª—è Event Store
```sql
-- supabase/migrations/003_event_store.sql
CREATE TABLE breeding_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  aggregate_id UUID NOT NULL,
  event_type TEXT NOT NULL,
  entity_type TEXT NOT NULL,
  event_data JSONB NOT NULL,
  metadata JSONB,
  user_id UUID NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  INDEX idx_aggregate_events (aggregate_id, created_at),
  INDEX idx_event_type (event_type)
);

-- –ü—Ä–æ–µ–∫—Ü—ñ—ó –¥–ª—è —à–≤–∏–¥–∫–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
CREATE MATERIALIZED VIEW breeding_statistics AS
SELECT 
  kennel_id,
  COUNT(DISTINCT sire_id) as active_sires,
  COUNT(DISTINCT dam_id) as active_dams,
  COUNT(*) as total_breedings
FROM breeding_events
WHERE event_type = 'DogBred'
GROUP BY kennel_id;
```

### –§–∞–∑–∞ 4: Web Workers (–¢–∏–∂–Ω—ñ 5-6)

#### Worker Manager
```typescript
// packages/workers/WorkerManager.ts
export class BreedHubWorkerManager {
  private workers = {
    dataProcessor: new Worker('/workers/data-processor.js'),
    syncWorker: new Worker('/workers/sync-worker.js'),
    analytics: new Worker('/workers/analytics.js')
  };
  
  // –ê–Ω–∞–ª—ñ–∑ —Ä–æ–¥–æ–≤–æ–¥—ñ–≤ —É —Ñ–æ–Ω—ñ
  async analyzePedigree(dogId: string): Promise<PedigreeAnalysis> {
    return new Promise((resolve) => {
      this.workers.analytics.postMessage({
        type: 'PEDIGREE_ANALYSIS',
        entityType: 'dog',
        id: dogId
      });
      
      this.workers.analytics.onmessage = (e) => {
        if (e.data.type === 'PEDIGREE_ANALYSIS_COMPLETE') {
          resolve(e.data.result);
        }
      };
    });
  }
  
  // –§–æ–Ω–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
  startBackgroundSync() {
    this.workers.syncWorker.postMessage({
      type: 'START_SYNC',
      interval: 30000 // 30 —Å–µ–∫—É–Ω–¥
    });
  }
}
```

#### Data Processing Worker
```typescript
// packages/workers/data-processor/index.ts
self.addEventListener('message', async (event) => {
  const { type, data } = event.data;
  
  switch (type) {
    case 'PROCESS_BULK_IMPORT':
      const processed = await processBulkDogs(data);
      self.postMessage({ 
        type: 'BULK_IMPORT_COMPLETE', 
        result: processed 
      });
      break;
      
    case 'CALCULATE_INBREEDING':
      const coi = await calculateCOI(data.pedigree);
      self.postMessage({ 
        type: 'INBREEDING_CALCULATED', 
        result: coi 
      });
      break;
  }
});
```

### –§–∞–∑–∞ 5: PWA –∑ –Ω—É–ª—è (–¢–∏–∂–Ω—ñ 1-4)

#### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ Local-First PWA –ø—Ä–æ–µ–∫—Ç—É
```bash
# –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç –∑ Vite
npm create vite@latest breedhub-pwa -- --template react-ts
cd breedhub-pwa

# Local-First –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
npm install yjs y-indexeddb y-websocket
npm install @preact/signals-react
npm install dexie

# PWA —Ç–∞ AI –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
npm install -D vite-plugin-pwa workbox-window
npm install @mediapipe/tasks-genai

# Backend sync
npm install @supabase/supabase-js
```

#### PWA Configuration
```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      includeAssets: ['models/*.bin'],
      manifest: {
        name: 'BreedHub AI',
        short_name: 'BreedHub',
        theme_color: '#ffffff',
        display: 'standalone',
        orientation: 'portrait'
      },
      workbox: {
        maximumFileSizeToCacheInBytes: 600 * 1024 * 1024, // 600MB –¥–ª—è Gemma
        runtimeCaching: [{
          urlPattern: /^https:\/\/.*\/models\/.*/,
          handler: 'CacheFirst',
          options: {
            cacheName: 'ai-models-cache'
          }
        }]
      }
    })
  ]
});
```

### –§–∞–∑–∞ 6: Gemma 270M —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è (–¢–∏–∂–Ω—ñ 5-8)

#### Browser-based Gemma –∑ WebGPU
```typescript
// src/ai/GemmaService.ts
import { LlmInference } from '@mediapipe/tasks-genai';

export class GemmaService {
  private model: LlmInference | null = null;
  
  async initialize(onProgress?: (percent: number) => void) {
    // Check WebGPU support
    const hasWebGPU = 'gpu' in navigator;
    
    this.model = await LlmInference.createFromOptions({
      baseOptions: {
        modelAssetPath: '/models/gemma-270m.bin', // 540MB
        delegate: hasWebGPU ? 'GPU' : 'CPU'
      },
      maxTokens: 512,
      temperature: 0.7
    }, onProgress);
  }
  
  // Natural Language –∫–æ–º–∞–Ω–¥–∏
  async parseCommand(text: string): Promise<any> {
    const prompt = `Parse breeding command: "${text}"
    Examples:
    - "–∑–∞–ø–∏—à–∏ –≤–∞–≥—É –ú–∞–∫—Å–∞ 450–≥" ‚Üí {"action":"weight","name":"–ú–∞–∫—Å","value":450}
    - "–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π –Ω–∞ –≤–∏—Å—Ç–∞–≤–∫—É" ‚Üí {"action":"show_register"}
    Return JSON`;
    
    const response = await this.model!.generateResponse(prompt);
    return JSON.parse(response);
  }
  
  // –ü–æ—à—É–∫ –Ω–∞–π–∫—Ä–∞—â–æ—ó –ø–∞—Ä–∏
  async findBestMatch(dog: Dog, candidates: Dog[]): Promise<Match[]> {
    const prompt = `Rate breeding matches for ${dog.name}:
    ${candidates.map(c => `${c.name}: ${c.titles}, COI:${c.coi}`).join('\n')}
    Return JSON array with scores 0-100`;
    
    const response = await this.model!.generateResponse(prompt);
    return JSON.parse(response);
  }
}
```

#### Server-side Gemma –≤ Windmill
```python
# windmill/f/ai/pedigree_parser.py
from transformers import AutoModelForCausalLM, AutoTokenizer
import json
import wmill

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Windmill resources –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Supabase
supabase = wmill.get_resource("u/annamaliyenko/pleasing_supabase")

def parse_pedigree_batch(documents: list) -> list:
    """–ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä—Ö—ñ–≤–Ω–∏—Ö —Ä–æ–¥–æ–≤–æ–¥—ñ–≤"""
    model = AutoModelForCausalLM.from_pretrained(
        "google/gemma-2-270m",  # –°–ø–æ—á–∞—Ç–∫—É –±–∞–∑–æ–≤–∞ –º–æ–¥–µ–ª—å
        device_map="cpu"
    )
    
    results = []
    for doc in documents:
        prompt = f"Extract dog pedigree info: {doc}"
        parsed = model.generate(prompt)
        results.append(json.loads(parsed))
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ Supabase
    supabase.table('parsed_pedigrees').insert(results).execute()
    return results

def detect_duplicates(dogs: list) -> dict:
    """–ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è"""
    # –°–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è –±–µ–∑ pgvector —Å–ø–æ—á–∞—Ç–∫—É
    duplicates = {}
    for i, dog1 in enumerate(dogs):
        for j, dog2 in enumerate(dogs[i+1:], i+1):
            if similarity_score(dog1, dog2) > 0.95:
                duplicates.setdefault(dog1['id'], []).append(dog2['id'])
    
    return duplicates
```

### –§–∞–∑–∞ 7: –í—ñ—Ä—Ç—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç—ñ–≤ (–¢–∏–∂–Ω—ñ 15-16)

```typescript
// components/DogList/VirtualDogGrid.tsx
import { useVirtualizer } from '@tanstack/react-virtual';

export const VirtualDogGrid = ({ dogs }: { dogs: Dog[] }) => {
  const containerRef = useRef<HTMLDivElement>(null);
  
  const rowVirtualizer = useVirtualizer({
    count: Math.ceil(dogs.length / 4),
    getScrollElement: () => containerRef.current,
    estimateSize: () => 300,
    overscan: 2
  });
  
  return (
    <div ref={containerRef} className="dog-grid h-full overflow-auto">
      <div style={{ height: `${rowVirtualizer.getTotalSize()}px` }}>
        {rowVirtualizer.getVirtualItems().map(virtualRow => (
          <div
            key={virtualRow.index}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              height: `${virtualRow.size}px`,
              transform: `translateY(${virtualRow.start}px)`
            }}
          >
            <DogCardRow 
              dogs={dogs.slice(
                virtualRow.index * 4, 
                (virtualRow.index + 1) * 4
              )}
            />
          </div>
        ))}
      </div>
    </div>
  );
};
```

## Premium —Ñ—É–Ω–∫—Ü—ñ—ó –∑ Gemma AI

### –ë–µ–∑–ø–ª–∞—Ç–Ω–∞ –≤–µ—Ä—Å—ñ—è
- –†—É—á–Ω–µ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º–∏
- –ë–∞–∑–æ–≤—ñ –∑–≤—ñ—Ç–∏ —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –î–æ 10 —Å–æ–±–∞–∫
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ —Ç–∞ –ø–æ—à—É–∫

### Premium –≤–µ—Ä—Å—ñ—è (–∑ Gemma)
- **Natural Language –∫–æ–º–∞–Ω–¥–∏**: "–ó–∞–ø–∏—à–∏ –≤–∞–≥—É —Ü—É—Ü–µ–Ω—è—Ç –õ—É–Ω–∏: –ú–∞–∫—Å 450–≥, –ë–µ–ª–ª–∞ 420–≥"
- **–ü–æ—à—É–∫ –Ω–∞–π–∫—Ä–∞—â–æ—ó –ø–∞—Ä–∏**: –ê–Ω–∞–ª—ñ–∑ –≥–µ–Ω–µ—Ç–∏–∫–∏, COI, —Ç–∏—Ç—É–ª—ñ–≤
- **–ê–Ω–∞–ª—ñ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –ø–æ—Ä–æ–¥–∏**: –û—Ü—ñ–Ω–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ 0-100
- **–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ–º–µ–Ω**: –ó–∞ —Ç–µ–º–æ—é –ø–æ—Å–ª—ñ—Ç—É —Ç–∞ –ª—ñ—Ç–µ—Ä–æ—é
- **–ü–∞—Ä—Å–∏–Ω–≥ —Ä–æ–¥–æ–≤–æ–¥—ñ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —ñ–º–ø–æ—Ä—Ç –∑ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
- **–í–∏—è–≤–ª–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤**: –ú–µ—Ä–¥–∂ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
- **–ù–µ–æ–±–º–µ–∂–µ–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–æ–±–∞–∫**

### –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Premium
```typescript
// apps/mobile/src/screens/AIAssistantScreen.tsx
const AIAssistant = () => {
  const { subscription } = useUser();
  
  if (!subscription.isPremium) {
    return <UpgradePrompt feature="AI Assistant" price="$9.99/month" />;
  }
  
  const gemma = useGemmaClient(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –º–æ–¥–µ–ª—å –Ω–∞ device
  
  return (
    <VoiceInput 
      onCommand={async (text) => {
        const action = await gemma.processCommand(text);
        await executeAction(action);
      }}
    />
  );
};
```

## AI Integration –ø—Ä–∞–≤–∏–ª–∞

### CLAUDE.md –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
```markdown
# BreedHub Architecture Rules

## Core Principles
- Use MultiStore for all entities
- SignalStore for reactive state  
- PowerSync for offline operations
- Events ONLY for breeding/health operations
- Windmill for complex computations
- Web Workers for heavy processing

## Code Conventions
- TypeScript strict mode always
- Functional components with hooks
- Lazy loading for heavy components
- All operations must be idempotent
- Consider offline-first for all features

## Entity Structure
Every entity MUST follow:
- Has type field
- Extends BaseEntity
- Registered in MultiStore
- Has offline sync rules
- Emits events for critical changes

## Performance Requirements
- UI response < 10ms (offline)
- Sync latency < 1s (online)
- Support 10M+ records
- 60fps scrolling always
```

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø—ñ—Ö—É

| –ú–µ—Ç—Ä–∏–∫–∞ | –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω | –¶—ñ–ª—å–æ–≤–∏–π —Å—Ç–∞–Ω | –Ø–∫ –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ |
|---------|---------------|---------------|---------------|
| –í—ñ–¥–≥—É–∫ UI | 100-200ms | <10ms offline | Performance.now() |
| –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è | –†–µ–∞–ª—Ç–∞–π–º | CRDT auto-merge | Sync conflict rate |
| –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è | 10K –∑–∞–ø–∏—Å—ñ–≤ | 10M+ –∑–∞–ø–∏—Å—ñ–≤ | Load testing |
| –û—Ñ–ª–∞–π–Ω —Ä–æ–±–æ—Ç–∞ | –ù–µ–º–∞—î | 100% —Ñ—É–Ω–∫—Ü—ñ–π | Feature coverage |
| –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω | –ù–µ–º–∞—î | –ü–æ–≤–Ω–∞ —á–µ—Ä–µ–∑ events | Event store size |
| –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ä–æ–∑—Ä–æ–±–∫–∏ | Baseline | +70% –∑ AI | Commit frequency |

## –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è

### Supabase RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
```sql
-- –ü–µ—Ç–ª–æ–≤–µ—Ä–∏ –±–∞—á–∞—Ç—å –ª–∏—à–µ —Å–≤–æ—ó—Ö —Ç–≤–∞—Ä–∏–Ω
CREATE POLICY "pet_lovers_own_dogs" ON dogs
  FOR ALL USING (
    auth.uid() = owner_id AND 
    user_type = 'pet_lover'
  );

-- –ë—Ä—ñ–¥–µ—Ä–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ kennels
CREATE POLICY "breeders_kennel_access" ON dogs
  FOR ALL USING (
    kennel_id IN (
      SELECT kennel_id FROM breeder_kennels 
      WHERE breeder_id = auth.uid()
    )
  );

-- Event store - —Ç—ñ–ª—å–∫–∏ append
CREATE POLICY "append_only_events" ON breeding_events
  FOR INSERT WITH CHECK (user_id = auth.uid());
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è

### –ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
- PowerSync sync queue size
- Event store growth rate
- Worker memory usage
- Offline cache size
- Sync conflict frequency

### Maintenance tasks
- Weekly: Compact event store projections
- Monthly: Analyze sync patterns
- Quarterly: Review offline storage usage

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —ñ—Å–Ω—É—é—á–æ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

### –í–∏–∫–ª–∏–∫–∏
1. **–†–æ–∑–¥—ñ–ª–µ–Ω—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó**: BreedHub —ñ Windmill –æ–∫—Ä–µ–º–æ - –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤
2. **–õ–æ–∫–∞–ª—å–Ω–∏–π Supabase**: –ù–∞ dev.dogarray.com —á–µ—Ä–µ–∑ Coolify - —É—Å–∫–ª–∞–¥–Ω—é—î CI/CD
3. **–†—É—á–Ω—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó**: SQL –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ psql
4. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –º–æ–Ω–æ—Ä–µ–ø–æ –∑ backend**: Windmill –Ω–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó

### –ü–µ—Ä–µ–≤–∞–≥–∏
1. **–ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å**: –í–ª–∞—Å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä –∑ Supabase
2. **–ì–Ω—É—á–∫—ñ—Å—Ç—å Windmill**: –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Å–∫—Ä–∏–ø—Ç–∏
3. **–Ü—Å–Ω—É—é—á–∞ –±–∞–∑–∞**: –í–∂–µ –ø—Ä–∞—Ü—é—é—á—ñ web –¥–æ–¥–∞—Ç–∫–∏ —Ç–∞ API

## –†–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π Roadmap –¥–ª—è PWA

### –ï—Ç–∞–ø 1: MVP (–¢–∏–∂–Ω—ñ 1-4)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π PWA –ø—Ä–æ–µ–∫—Ç –∑ Vite
- [ ] –ë–∞–∑–æ–≤–∏–π UI –¥–ª—è breeds/dogs
- [ ] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Supabase
- [ ] Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω
- [ ] PWA deployment –Ω–∞ Vercel/Netlify

### –ï—Ç–∞–ø 2: AI Integration (–¢–∏–∂–Ω—ñ 5-8)
- [ ] –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ Gemma 270M —á–µ—Ä–µ–∑ MediaPipe
- [ ] WebGPU –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
- [ ] Natural Language Interface
- [ ] Premium subscription —á–µ—Ä–µ–∑ Stripe
- [ ] AI —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è breeding analysis

### –ï—Ç–∞–ø 3: Advanced Features (–¢–∏–∂–Ω—ñ 9-12)
- [ ] PowerSync –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ–≥–æ –æ—Ñ–ª–∞–π–Ω
- [ ] Windmill —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –¥–ª—è batch processing
- [ ] Push notifications (Web Push API)
- [ ] Install prompts –¥–ª—è mobile
- [ ] App Store/Play Store —á–µ—Ä–µ–∑ Capacitor (–æ–ø—Ü—ñ–π–Ω–æ)

### –ï—Ç–∞–ø 4: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è (–ú—ñ—Å—è—Ü—ñ 4-6)
- [ ] Performance tuning –¥–ª—è 100K+ –∑–∞–ø–∏—Å—ñ–≤
- [ ] CDN –¥–ª—è –º–æ–¥–µ–ª–µ–π —Ç–∞ –∑–æ–±—Ä–∞–∂–µ–Ω—å
- [ ] A/B testing –¥–ª—è AI features
- [ ] Analytics —Ç–∞ monitoring

## –ß–æ–º—É Local-First PWA –¥–ª—è BreedHub?

### –ü–µ—Ä–µ–≤–∞–≥–∏ Local-First –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ (–∑–∞ –®–µ–º—Å–µ–¥—ñ–Ω–æ–≤–∏–º)
1. **–ú–∏—Ç—Ç—î–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å** - –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–∫–∞–ª—å–Ω—ñ (<1ms)
2. **–ü–æ–≤–Ω–∞ –æ—Ñ–ª–∞–π–Ω —Ä–æ–±–æ—Ç–∞** - –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤** - CRDT merge
4. **–ü—Ä–∏–≤–∞—Ç–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö** - –≤—Å–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
5. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - —Å–µ—Ä–≤–µ—Ä –ª–∏—à–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
6. **Resilience** - –Ω–µ–º–∞—î single point of failure

### –ü–µ—Ä–µ–≤–∞–≥–∏ PWA –ø—ñ–¥—Ö–æ–¥—É
1. **–Ñ–¥–∏–Ω–∞ –∫–æ–¥–æ–≤–∞ –±–∞–∑–∞** –¥–ª—è –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
2. **–ú–∏—Ç—Ç—î–≤—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** –±–µ–∑ App Store review
3. **Gemma 270M —á–µ—Ä–µ–∑ WebGPU** - 15-40 tokens/s
4. **Install —è–∫ native app** –Ω–∞ –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
5. **SEO —Ç–∞ sharing** - —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è Google
6. **–ù–∏–∂—á–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å** —Ä–æ–∑—Ä–æ–±–∫–∏

### PWA —è–∫ Native App
- **Install prompt** –Ω–∞ mobile/desktop
- **Offline mode** —á–µ—Ä–µ–∑ Service Workers
- **Push notifications** (–∫—Ä—ñ–º iOS Safari)
- **Home screen icon** —Ç–∞ splash screen
- **Standalone mode** –±–µ–∑ browser UI
- **File system access** –¥–ª—è import/export

### Fallback –ø–ª–∞–Ω
–Ø–∫—â–æ –∑–≥–æ–¥–æ–º –ø–æ—Ç—Ä—ñ–±–µ–Ω native –¥–æ—Å—Ç—É–ø:
```javascript
// –û–±–≥–æ—Ä—Ç–∞—î–º–æ PWA –≤ Capacitor
npm install @capacitor/core @capacitor/ios @capacitor/android
npx cap init
npx cap add ios
npx cap add android
// PWA —Å—Ç–∞—î native app!
```

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- [Vite PWA Plugin](https://vite-pwa-org.netlify.app/)
- [MediaPipe LLM Inference](https://developers.google.com/mediapipe/solutions/genai/llm_inference/web_js)
- [WebLLM](https://webllm.mlc.ai/)
- [PowerSync Docs](https://docs.powersync.com)
- [Supabase Local Development](https://supabase.com/docs/guides/local-development)
- [Windmill Documentation](https://windmill.dev/docs)